<section class="flex wrap">
  <mat-card class="grow-3 basis-500 distant">
    <h2>Teilnahmen</h2>

    <div *ngIf="participations.length == 0">
      <p>Es sind keine Teilnahmen registriert.</p>
      <p>Über das Formular <i>Neue Teilnahme</i> kannst du neue Registrierungen vornehmen. Diese werden dann hier
        tabellarisch aufgelistet.</p>
    </div>

    <mat-table *ngIf="participations.length > 0" [dataSource]="participations">

      <ng-container matColumnDef="_id">
        <mat-header-cell *matHeaderCellDef class="grow-1">ID</mat-header-cell>
        <mat-cell *matCellDef="let row" class="grow-1">{{ row._id }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="ticket">
        <mat-header-cell *matHeaderCellDef class="grow-1">Gewinnlos</mat-header-cell>
        <mat-cell *matCellDef="let row" class="grow-1">L{{ row.ticket.list }}N{{ row.ticket.number }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef class="grow-3">Name</mat-header-cell>
        <mat-cell *matCellDef="let row" class="grow-3">{{ row.user ? row.user.firstName + ' ' + row.user.lastName : 'unbekannt' }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="term">
        <mat-header-cell *matHeaderCellDef class="grow-2">Laufzeit</mat-header-cell>
        <mat-cell *matCellDef="let row" class="grow-2">
          <span *ngIf="row.term.end; then termBlock; else startBlock"></span>
          <ng-template #termBlock>{{ row.term.start | date: 'dd.MM.yyyy' }} bis {{ row.term.end | date: 'dd.MM.yyyy' }}</ng-template>
          <ng-template #startBlock>ab {{ row.term.start | date: 'dd.MM.yyyy' }}</ng-template>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef class="grow-2"></mat-header-cell>
        <mat-cell *matCellDef="let row" class="grow-2">
          <div class="flex end w-100">
            <button class="mat-icon-button mat-primary show-on-hover"
                    title="Informationen anzeigen" (click)="onInfo(row._id)">
              <span class="mat-button-wrapper">
                <mat-icon>info_outline</mat-icon>
              </span>
            </button>
            <button class="mat-icon-button mat-primary show-on-hover"
                    title="Teilnahme beenden" (click)="onEnd(row._id)">
              <span class="mat-button-wrapper">
                <mat-icon>exit_to_app</mat-icon>
              </span>
            </button>
            <button class="mat-icon-button mat-primary show-on-hover"
                    title="Teilnahme löschen" (click)="onDelete(row._id)">
              <span class="mat-button-wrapper">
                <mat-icon color="warn">delete_outline</mat-icon>
              </span>
            </button>
          </div>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="participationColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: participationColumns" id="{{ row._id }}">
      </mat-row>
    </mat-table>
  </mat-card>

  <mat-card class="grow-1 basis-300 distant">
    <h2>Teilnehmer</h2>

    <div *ngIf="users.length == 0">
      <p>Es sind keine Teilnehmer registriert.</p>
      <p>Über das Formular <i>Neue Teilnahme</i> kannst du neue Registrierungen vornehmen. Die Teilnehmer werden dann hier
        tabellarisch aufgelistet.</p>
    </div>

    <mat-table *ngIf="users.length > 0" [dataSource]="users">
      <ng-container matColumnDef="_id">
        <mat-header-cell *matHeaderCellDef class="grow-1">ID</mat-header-cell>
        <mat-cell *matCellDef="let user" class="grow-1">{{ user._id }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef class="grow-3">Name</mat-header-cell>
        <mat-cell *matCellDef="let user" class="grow-3">{{ user.firstName }} {{ user.lastName }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef class="grow-2"></mat-header-cell>
        <mat-cell *matCellDef="let user" class="grow-2">
          <div class="flex end w-100">
            <button class="mat-icon-button mat-primary show-on-hover" title="Informationen anzeigen" (click)="onUserInfo(user._id)">
              <span class="mat-button-wrapper">
                <mat-icon>info_outline</mat-icon>
              </span>
            </button>
            <button class="mat-icon-button mat-primary show-on-hover" title="Teilnehmer löschen" (click)="onDeleteUser(user._id)">
              <span class="mat-button-wrapper">
                <mat-icon color="warn">delete_outline</mat-icon>
              </span>
            </button>
          </div>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="userColumns"></mat-header-row>
      <mat-row *matRowDef="let user; columns: userColumns" id="{{ user._id }}">
      </mat-row>
    </mat-table>

  </mat-card>

  <mat-card id="add-participation" class="grow-1 basis-300 distant">
    <h2>Neue Teilnahme</h2>
    <app-add-participation></app-add-participation>
  </mat-card>
</section>